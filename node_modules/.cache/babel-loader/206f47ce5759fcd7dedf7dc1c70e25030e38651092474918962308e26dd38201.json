{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\skyki\\\\PycharmProjects\\\\musiceblya228\\\\src\\\\components\\\\VoiceChannel.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Box, Button, Typography, IconButton, Paper, Avatar, List, ListItem, ListItemAvatar, ListItemText, Slider, Tooltip, Badge, Divider, Alert } from '@mui/material';\nimport { Mic as MicIcon, MicOff as MicOffIcon, VolumeUp as VolumeUpIcon, VolumeOff as VolumeOffIcon, Headset as HeadsetIcon, HeadsetOff as HeadsetOffIcon, Settings as SettingsIcon, ScreenShare as ScreenShareIcon, Videocam as VideoIcon, VideocamOff as VideoOffIcon, MoreVert as MoreVertIcon } from '@mui/icons-material';\nimport { useAuth } from '../contexts/AuthContext';\nimport config from '../config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VoiceChannel = ({\n  channelId\n}) => {\n  _s();\n  const {\n    token,\n    setToken\n  } = useAuth();\n  const [isConnected, setIsConnected] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isDeafened, setIsDeafened] = useState(false);\n  const [isVideoEnabled, setIsVideoEnabled] = useState(false);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [participants, setParticipants] = useState([]);\n  const [volume, setVolume] = useState(100);\n  const [showSettings, setShowSettings] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected'); // 'disconnected', 'connecting', 'connected'\n  const [error, setError] = useState('');\n  const [isEchoMode, setIsEchoMode] = useState(false);\n\n  // Add new state variables for audio handling\n  const [audioStream, setAudioStream] = useState(null);\n  const [audioContext, setAudioContext] = useState(null);\n  const [audioProcessor, setAudioProcessor] = useState(null);\n  const wsRef = useRef(null);\n  const mediaStreamRef = useRef(null);\n  const audioContextRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const videoStreamRef = useRef(null);\n  const screenStreamRef = useRef(null);\n  const videoContainerRef = useRef(null);\n  const localVideoRef = useRef(null);\n\n  // Initialize participants list\n  useEffect(() => {\n    setParticipants([]);\n  }, [channelId]);\n  useEffect(() => {\n    connect();\n    return () => {\n      disconnect();\n    };\n  }, [channelId, token]); // Add token as dependency\n\n  const connect = async () => {\n    try {\n      setConnectionStatus('connecting');\n      setError('');\n\n      // Try to refresh token before connecting\n      try {\n        const response = await fetch(`${config.API_BASE_URL}/token/refresh`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (response.ok) {\n          const data = await response.json();\n          localStorage.setItem('token', data.access_token);\n          setToken(data.access_token);\n        }\n      } catch (error) {\n        console.error('Error refreshing token:', error);\n        setError('Authentication failed. Please log in again.');\n        return;\n      }\n\n      // Get the WebSocket protocol based on the current protocol\n      const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      const wsUrl = `${wsProtocol}//${config.SERVER_IP}:${config.SERVER_PORT}/ws/voice/${channelId}?token=${encodeURIComponent(token)}`;\n      console.log('Connecting to WebSocket:', wsUrl);\n\n      // Close existing connection if any\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n      wsRef.current = new WebSocket(wsUrl);\n\n      // Set connection timeout\n      const connectionTimeout = setTimeout(() => {\n        var _wsRef$current;\n        if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) !== WebSocket.OPEN) {\n          var _wsRef$current2;\n          console.error('WebSocket connection timeout');\n          setError('Connection timeout. Please try again.');\n          (_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.close();\n        }\n      }, 5000);\n\n      // Set up ping interval to keep connection alive\n      const pingInterval = setInterval(() => {\n        var _wsRef$current3;\n        if (((_wsRef$current3 = wsRef.current) === null || _wsRef$current3 === void 0 ? void 0 : _wsRef$current3.readyState) === WebSocket.OPEN) {\n          try {\n            wsRef.current.send(JSON.stringify({\n              type: 'ping'\n            }));\n            console.log('Sent ping message');\n          } catch (error) {\n            console.error('Error sending ping:', error);\n          }\n        }\n      }, 15000);\n\n      // Set up connection health check\n      const healthCheckInterval = setInterval(() => {\n        var _wsRef$current4;\n        if (((_wsRef$current4 = wsRef.current) === null || _wsRef$current4 === void 0 ? void 0 : _wsRef$current4.readyState) !== WebSocket.OPEN) {\n          console.log('Connection health check failed, attempting to reconnect...');\n          reconnect();\n        }\n      }, 30000);\n      wsRef.current.onopen = async () => {\n        console.log('WebSocket connected successfully');\n        clearTimeout(connectionTimeout);\n        setConnectionStatus('connected');\n        setIsConnected(true);\n\n        // Send join message to server\n        try {\n          var _wsRef$current5;\n          if (((_wsRef$current5 = wsRef.current) === null || _wsRef$current5 === void 0 ? void 0 : _wsRef$current5.readyState) === WebSocket.OPEN) {\n            wsRef.current.send(JSON.stringify({\n              type: 'join'\n            }));\n            console.log('Sent join message');\n\n            // Start audio stream after successful connection\n            await startAudioStream();\n          }\n        } catch (error) {\n          console.error('Error sending join message:', error);\n          setError('Failed to join voice channel. Please try again.');\n          disconnect();\n        }\n      };\n      wsRef.current.onclose = async event => {\n        console.log('WebSocket closed:', event.code, event.reason);\n        clearTimeout(connectionTimeout);\n        clearInterval(pingInterval);\n        clearInterval(healthCheckInterval);\n        setConnectionStatus('disconnected');\n        setIsConnected(false);\n        stopAudioStream();\n        stopVideoStream();\n        stopScreenShare();\n\n        // Handle specific error codes\n        switch (event.code) {\n          case 4000:\n            setError('Authentication failed. Please log in again.');\n            break;\n          case 4001:\n            setError('Invalid voice channel.');\n            break;\n          case 4002:\n            setError('You are not a member of this server.');\n            break;\n          case 4003:\n            setError('User not found. Please log in again.');\n            break;\n          case 1006:\n            setError('Connection lost. Attempting to reconnect...');\n            reconnect();\n            break;\n          default:\n            setError(`Connection closed: ${event.reason || 'Unknown error'}`);\n            // Try to reconnect if the connection was lost\n            if (event.code !== 1000) {\n              reconnect();\n            }\n        }\n      };\n      wsRef.current.onerror = error => {\n        console.error('WebSocket error:', error);\n        // Don't clear intervals or disconnect on error\n        // Let the onclose handler handle the cleanup\n      };\n      wsRef.current.onmessage = async event => {\n        if (event.data instanceof Blob) {\n          try {\n            console.log('Received audio data blob, size:', event.data.size);\n            await playAudio(event.data);\n          } catch (error) {\n            console.error('Error processing audio data:', error);\n          }\n        } else {\n          try {\n            const data = JSON.parse(event.data);\n            console.log('Received WebSocket message:', data);\n            if (data.type === 'token_refresh') {\n              // Update token in localStorage and component\n              localStorage.setItem('token', data.token);\n              setToken(data.token);\n              console.log('Token refreshed successfully');\n              return;\n            }\n            if (data.type === 'ping') {\n              try {\n                wsRef.current.send(JSON.stringify({\n                  type: 'pong'\n                }));\n                console.log('Sent pong response');\n              } catch (error) {\n                console.error('Error sending pong:', error);\n              }\n              return;\n            }\n            handleWebSocketMessage(data);\n          } catch (error) {\n            console.error('Error parsing WebSocket message:', error);\n          }\n        }\n      };\n    } catch (error) {\n      console.error('Error connecting to voice channel:', error);\n      setError('Failed to connect to voice channel. Please try again later.');\n      setConnectionStatus('disconnected');\n    }\n  };\n  const handleWebSocketMessage = data => {\n    console.log('Handling WebSocket message:', data);\n    switch (data.type) {\n      case 'participants':\n        if (Array.isArray(data.participants)) {\n          setParticipants(data.participants);\n          setIsEchoMode(data.isEchoMode);\n        }\n        break;\n      case 'participant_joined':\n        if (data.participant) {\n          setParticipants(prev => [...prev, data.participant]);\n          setIsEchoMode(data.isEchoMode);\n        }\n        break;\n      case 'participant_left':\n        if (data.userId) {\n          setParticipants(prev => prev.filter(p => p.id !== data.userId));\n          setIsEchoMode(data.isEchoMode);\n        }\n        break;\n      case 'audio':\n        if (!isDeafened && data.data) {\n          playAudio(data.data);\n        }\n        break;\n      case 'connection_status':\n        console.log('Connection status:', data.status);\n        if (data.status === 'connected') {\n          setConnectionStatus('connected');\n          setIsConnected(true);\n        }\n        break;\n      case 'pong':\n        console.log('Received pong response');\n        break;\n      default:\n        console.log('Unknown message type:', data.type);\n    }\n  };\n  const reconnect = () => {\n    console.log('Attempting to reconnect...');\n    setTimeout(() => {\n      var _wsRef$current6;\n      if (((_wsRef$current6 = wsRef.current) === null || _wsRef$current6 === void 0 ? void 0 : _wsRef$current6.readyState) !== WebSocket.OPEN) {\n        connect();\n      }\n    }, 3000);\n  };\n  const disconnect = () => {\n    if (wsRef.current) {\n      // Send leave message before closing\n      if (wsRef.current.readyState === WebSocket.OPEN) {\n        try {\n          wsRef.current.send(JSON.stringify({\n            type: 'leave'\n          }));\n        } catch (error) {\n          console.error('Error sending leave message:', error);\n        }\n      }\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n    stopAudioStream();\n    stopVideoStream();\n    stopScreenShare();\n    setIsConnected(false);\n  };\n  const startAudioStream = async () => {\n    try {\n      console.log('Starting audio stream...');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 1\n        }\n      });\n      console.log('Got media stream:', stream.getAudioTracks()[0].label);\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const source = audioContext.createMediaStreamSource(stream);\n      const processor = audioContext.createScriptProcessor(1024, 1, 1);\n      source.connect(processor);\n      processor.connect(audioContext.destination);\n      processor.onaudioprocess = e => {\n        var _wsRef$current7;\n        if (!isMuted && ((_wsRef$current7 = wsRef.current) === null || _wsRef$current7 === void 0 ? void 0 : _wsRef$current7.readyState) === WebSocket.OPEN) {\n          const inputData = e.inputBuffer.getChannelData(0);\n          // Convert Float32Array to Int16Array for better compatibility\n          const pcmData = new Int16Array(inputData.length);\n          for (let i = 0; i < inputData.length; i++) {\n            pcmData[i] = Math.max(-32768, Math.min(32767, Math.round(inputData[i] * 32767)));\n          }\n\n          // Convert to base64\n          const base64Data = btoa(String.fromCharCode.apply(null, new Uint8Array(pcmData.buffer)));\n          try {\n            wsRef.current.send(JSON.stringify({\n              type: 'audio',\n              data: base64Data\n            }));\n          } catch (error) {\n            console.error('Error sending audio data:', error);\n          }\n        }\n      };\n      setAudioStream(stream);\n      setAudioContext(audioContext);\n      setAudioProcessor(processor);\n    } catch (error) {\n      console.error('Error starting audio stream:', error);\n      setError('Failed to access microphone. Please make sure you have granted microphone permissions.');\n    }\n  };\n  const stopAudioStream = () => {\n    if (mediaRecorderRef.current) {\n      mediaRecorderRef.current.stop();\n      mediaRecorderRef.current = null;\n    }\n    if (mediaStreamRef.current) {\n      mediaStreamRef.current.getTracks().forEach(track => track.stop());\n      mediaStreamRef.current = null;\n    }\n  };\n  const startVideoStream = async () => {\n    try {\n      var _wsRef$current8;\n      // Request both video and audio to ensure we have the right permissions\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: 'user'\n        },\n        audio: true\n      });\n      console.log('Video stream started:', stream.getVideoTracks()[0].label);\n      videoStreamRef.current = stream;\n      setIsVideoEnabled(true);\n\n      // Send video stream to other participants\n      if (((_wsRef$current8 = wsRef.current) === null || _wsRef$current8 === void 0 ? void 0 : _wsRef$current8.readyState) === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'video_start',\n          userId: localStorage.getItem('userId')\n        }));\n      }\n\n      // Set the stream to the video element\n      if (localVideoRef.current) {\n        localVideoRef.current.srcObject = stream;\n      }\n    } catch (error) {\n      console.error('Error accessing camera:', error);\n      setError('Failed to access camera. Please make sure you have granted camera permissions.');\n      setIsVideoEnabled(false);\n    }\n  };\n  const stopVideoStream = () => {\n    if (videoStreamRef.current) {\n      var _wsRef$current9;\n      videoStreamRef.current.getTracks().forEach(track => track.stop());\n      videoStreamRef.current = null;\n      setIsVideoEnabled(false);\n      if (((_wsRef$current9 = wsRef.current) === null || _wsRef$current9 === void 0 ? void 0 : _wsRef$current9.readyState) === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'video_stop',\n          userId: localStorage.getItem('userId')\n        }));\n      }\n\n      // Clear the video stream\n      if (localVideoRef.current) {\n        localVideoRef.current.srcObject = null;\n      }\n    }\n  };\n  const startScreenShare = async () => {\n    try {\n      var _wsRef$current0;\n      const stream = await navigator.mediaDevices.getDisplayMedia({\n        video: true\n      });\n      screenStreamRef.current = stream;\n      setIsScreenSharing(true);\n      if (((_wsRef$current0 = wsRef.current) === null || _wsRef$current0 === void 0 ? void 0 : _wsRef$current0.readyState) === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'screen_share_start',\n          userId: localStorage.getItem('userId')\n        }));\n      }\n    } catch (error) {\n      console.error('Error sharing screen:', error);\n    }\n  };\n  const stopScreenShare = () => {\n    if (screenStreamRef.current) {\n      var _wsRef$current1;\n      screenStreamRef.current.getTracks().forEach(track => track.stop());\n      screenStreamRef.current = null;\n      setIsScreenSharing(false);\n      if (((_wsRef$current1 = wsRef.current) === null || _wsRef$current1 === void 0 ? void 0 : _wsRef$current1.readyState) === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'screen_share_stop',\n          userId: localStorage.getItem('userId')\n        }));\n      }\n    }\n  };\n  const playAudio = async audioData => {\n    try {\n      console.log('Starting audio playback...');\n\n      // Convert base64 back to Int16Array\n      const binaryString = atob(audioData);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n\n      // Convert to Float32Array for Web Audio API\n      const int16Data = new Int16Array(bytes.buffer);\n      const float32Data = new Float32Array(int16Data.length);\n      for (let i = 0; i < int16Data.length; i++) {\n        float32Data[i] = int16Data[i] / 32767.0;\n      }\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const audioBuffer = audioContext.createBuffer(1, float32Data.length, 48000);\n      audioBuffer.getChannelData(0).set(float32Data);\n      const source = audioContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(audioContext.destination);\n      source.onended = () => {\n        source.disconnect();\n        audioContext.close();\n      };\n      source.start(0);\n      console.log('Audio playback started');\n    } catch (error) {\n      console.error('Error playing audio:', error);\n    }\n  };\n  const sendWebSocketMessage = message => {\n    var _wsRef$current10;\n    if (((_wsRef$current10 = wsRef.current) === null || _wsRef$current10 === void 0 ? void 0 : _wsRef$current10.readyState) === WebSocket.OPEN) {\n      try {\n        wsRef.current.send(typeof message === 'string' ? message : JSON.stringify(message));\n      } catch (error) {\n        console.error('Error sending WebSocket message:', error);\n      }\n    } else {\n      var _wsRef$current11;\n      console.warn('WebSocket is not in OPEN state. Current state:', (_wsRef$current11 = wsRef.current) === null || _wsRef$current11 === void 0 ? void 0 : _wsRef$current11.readyState);\n    }\n  };\n  const toggleMute = () => {\n    if (mediaStreamRef.current) {\n      const audioTrack = mediaStreamRef.current.getAudioTracks()[0];\n      audioTrack.enabled = !audioTrack.enabled;\n      setIsMuted(!isMuted);\n      sendWebSocketMessage({\n        type: 'mute_state',\n        isMuted: !audioTrack.enabled\n      });\n    }\n  };\n  const toggleDeafen = () => {\n    setIsDeafened(!isDeafened);\n    if (audioContextRef.current) {\n      const gainNode = audioContextRef.current.createGain();\n      gainNode.gain.value = isDeafened ? volume / 100 : 0;\n    }\n    sendWebSocketMessage({\n      type: 'deafen_state',\n      isDeafened: !isDeafened\n    });\n  };\n  const toggleVideo = () => {\n    if (isVideoEnabled) {\n      stopVideoStream();\n    } else {\n      startVideoStream();\n    }\n    sendWebSocketMessage({\n      type: 'video_state',\n      isEnabled: !isVideoEnabled\n    });\n  };\n  const toggleScreenShare = () => {\n    if (isScreenSharing) {\n      stopScreenShare();\n    } else {\n      startScreenShare();\n    }\n    sendWebSocketMessage({\n      type: 'screen_share_state',\n      isEnabled: !isScreenSharing\n    });\n  };\n  const handleVolumeChange = (event, newValue) => {\n    setVolume(newValue);\n    if (audioContextRef.current && !isDeafened) {\n      audioContextRef.current.destination.volume = newValue / 100;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n      bgcolor: 'background.paper'\n    },\n    children: [error && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"error\",\n      sx: {\n        mb: 2\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 589,\n      columnNumber: 17\n    }, this), connectionStatus === 'connecting' && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Connecting to voice channel...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 17\n    }, this), isEchoMode && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Echo Mode Active - You are the only participant in this voice channel\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 601,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      ref: videoContainerRef,\n      sx: {\n        p: 2,\n        display: 'flex',\n        justifyContent: 'center',\n        bgcolor: 'background.default'\n      },\n      children: isVideoEnabled ? /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: localVideoRef,\n        autoPlay: true,\n        muted: true,\n        playsInline: true,\n        style: {\n          width: '100%',\n          maxHeight: '200px',\n          objectFit: 'cover',\n          borderRadius: '8px'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 617,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        color: \"text.secondary\",\n        children: \"Camera is disabled\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 630,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 607,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(List, {\n      sx: {\n        flex: 1,\n        overflow: 'auto'\n      },\n      children: Array.isArray(participants) && participants.map(participant => {\n        var _participant$username;\n        return /*#__PURE__*/_jsxDEV(ListItem, {\n          children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n            children: /*#__PURE__*/_jsxDEV(Badge, {\n              overlap: \"circular\",\n              anchorOrigin: {\n                vertical: 'bottom',\n                horizontal: 'right'\n              },\n              badgeContent: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  width: 12,\n                  height: 12,\n                  borderRadius: '50%',\n                  bgcolor: participant.isMuted ? 'error.main' : 'success.main',\n                  border: '2px solid',\n                  borderColor: 'background.paper'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 645,\n                columnNumber: 37\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Avatar, {\n                children: ((_participant$username = participant.username) === null || _participant$username === void 0 ? void 0 : _participant$username[0]) || '?'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 655,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 641,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 640,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: participant.username || 'Unknown User',\n            secondary: /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 1\n              },\n              children: [participant.isMuted && /*#__PURE__*/_jsxDEV(MicOffIcon, {\n                fontSize: \"small\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 662,\n                columnNumber: 61\n              }, this), participant.isDeafened && /*#__PURE__*/_jsxDEV(HeadsetOffIcon, {\n                fontSize: \"small\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 663,\n                columnNumber: 64\n              }, this), participant.isVideoEnabled && /*#__PURE__*/_jsxDEV(VideoIcon, {\n                fontSize: \"small\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 664,\n                columnNumber: 68\n              }, this), participant.isScreenSharing && /*#__PURE__*/_jsxDEV(ScreenShareIcon, {\n                fontSize: \"small\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 665,\n                columnNumber: 69\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 661,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 658,\n            columnNumber: 25\n          }, this)]\n        }, participant.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 639,\n          columnNumber: 21\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 637,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 2,\n        borderTop: 1,\n        borderColor: 'divider',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          gap: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n          title: isMuted ? \"Unmute\" : \"Mute\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            onClick: toggleMute,\n            color: isMuted ? \"error\" : \"default\",\n            children: isMuted ? /*#__PURE__*/_jsxDEV(MicOffIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 685,\n              columnNumber: 40\n            }, this) : /*#__PURE__*/_jsxDEV(MicIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 685,\n              columnNumber: 57\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 684,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 683,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n          title: isDeafened ? \"Undeafen\" : \"Deafen\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            onClick: toggleDeafen,\n            color: isDeafened ? \"error\" : \"default\",\n            children: isDeafened ? /*#__PURE__*/_jsxDEV(HeadsetOffIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 43\n            }, this) : /*#__PURE__*/_jsxDEV(HeadsetIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 64\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 689,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 682,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          gap: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n          title: isVideoEnabled ? \"Disable Video\" : \"Enable Video\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            onClick: toggleVideo,\n            color: isVideoEnabled ? \"primary\" : \"default\",\n            children: isVideoEnabled ? /*#__PURE__*/_jsxDEV(VideoIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 47\n            }, this) : /*#__PURE__*/_jsxDEV(VideoOffIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 63\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 697,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 696,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n          title: isScreenSharing ? \"Stop Sharing\" : \"Share Screen\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            onClick: toggleScreenShare,\n            color: isScreenSharing ? \"primary\" : \"default\",\n            children: /*#__PURE__*/_jsxDEV(ScreenShareIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 703,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 702,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 701,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 695,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: 1,\n          minWidth: 200\n        },\n        children: [/*#__PURE__*/_jsxDEV(VolumeUpIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Slider, {\n          value: volume,\n          onChange: handleVolumeChange,\n          \"aria-labelledby\": \"volume-slider\",\n          min: 0,\n          max: 100\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 710,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 708,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 674,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 581,\n    columnNumber: 9\n  }, this);\n};\n_s(VoiceChannel, \"ecYcAYwJvnjoYNv5txLT0TFYeck=\", false, function () {\n  return [useAuth];\n});\n_c = VoiceChannel;\nexport default VoiceChannel;\nvar _c;\n$RefreshReg$(_c, \"VoiceChannel\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Box","Button","Typography","IconButton","Paper","Avatar","List","ListItem","ListItemAvatar","ListItemText","Slider","Tooltip","Badge","Divider","Alert","Mic","MicIcon","MicOff","MicOffIcon","VolumeUp","VolumeUpIcon","VolumeOff","VolumeOffIcon","Headset","HeadsetIcon","HeadsetOff","HeadsetOffIcon","Settings","SettingsIcon","ScreenShare","ScreenShareIcon","Videocam","VideoIcon","VideocamOff","VideoOffIcon","MoreVert","MoreVertIcon","useAuth","config","jsxDEV","_jsxDEV","VoiceChannel","channelId","_s","token","setToken","isConnected","setIsConnected","isMuted","setIsMuted","isDeafened","setIsDeafened","isVideoEnabled","setIsVideoEnabled","isScreenSharing","setIsScreenSharing","participants","setParticipants","volume","setVolume","showSettings","setShowSettings","connectionStatus","setConnectionStatus","error","setError","isEchoMode","setIsEchoMode","audioStream","setAudioStream","audioContext","setAudioContext","audioProcessor","setAudioProcessor","wsRef","mediaStreamRef","audioContextRef","mediaRecorderRef","videoStreamRef","screenStreamRef","videoContainerRef","localVideoRef","connect","disconnect","response","fetch","API_BASE_URL","method","headers","ok","data","json","localStorage","setItem","access_token","console","wsProtocol","window","location","protocol","wsUrl","SERVER_IP","SERVER_PORT","encodeURIComponent","log","current","close","WebSocket","connectionTimeout","setTimeout","_wsRef$current","readyState","OPEN","_wsRef$current2","pingInterval","setInterval","_wsRef$current3","send","JSON","stringify","type","healthCheckInterval","_wsRef$current4","reconnect","onopen","clearTimeout","_wsRef$current5","startAudioStream","onclose","event","code","reason","clearInterval","stopAudioStream","stopVideoStream","stopScreenShare","onerror","onmessage","Blob","size","playAudio","parse","handleWebSocketMessage","Array","isArray","participant","prev","userId","filter","p","id","status","_wsRef$current6","stream","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","autoGainControl","sampleRate","channelCount","getAudioTracks","label","AudioContext","webkitAudioContext","source","createMediaStreamSource","processor","createScriptProcessor","destination","onaudioprocess","e","_wsRef$current7","inputData","inputBuffer","getChannelData","pcmData","Int16Array","length","i","Math","max","min","round","base64Data","btoa","String","fromCharCode","apply","Uint8Array","buffer","stop","getTracks","forEach","track","startVideoStream","_wsRef$current8","video","width","ideal","height","facingMode","getVideoTracks","getItem","srcObject","_wsRef$current9","startScreenShare","_wsRef$current0","getDisplayMedia","_wsRef$current1","audioData","binaryString","atob","bytes","charCodeAt","int16Data","float32Data","Float32Array","audioBuffer","createBuffer","set","createBufferSource","onended","start","sendWebSocketMessage","message","_wsRef$current10","_wsRef$current11","warn","toggleMute","audioTrack","enabled","toggleDeafen","gainNode","createGain","gain","value","toggleVideo","isEnabled","toggleScreenShare","handleVolumeChange","newValue","sx","display","flexDirection","bgcolor","children","severity","mb","fileName","_jsxFileName","lineNumber","columnNumber","ref","justifyContent","autoPlay","muted","playsInline","style","maxHeight","objectFit","borderRadius","variant","color","flex","overflow","map","_participant$username","overlap","anchorOrigin","vertical","horizontal","badgeContent","border","borderColor","username","primary","secondary","alignItems","gap","fontSize","borderTop","title","onClick","minWidth","onChange","_c","$RefreshReg$"],"sources":["C:/Users/skyki/PycharmProjects/musiceblya228/src/components/VoiceChannel.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport {\r\n    Box,\r\n    Button,\r\n    Typography,\r\n    IconButton,\r\n    Paper,\r\n    Avatar,\r\n    List,\r\n    ListItem,\r\n    ListItemAvatar,\r\n    ListItemText,\r\n    Slider,\r\n    Tooltip,\r\n    Badge,\r\n    Divider,\r\n    Alert\r\n} from '@mui/material';\r\nimport {\r\n    Mic as MicIcon,\r\n    MicOff as MicOffIcon,\r\n    VolumeUp as VolumeUpIcon,\r\n    VolumeOff as VolumeOffIcon,\r\n    Headset as HeadsetIcon,\r\n    HeadsetOff as HeadsetOffIcon,\r\n    Settings as SettingsIcon,\r\n    ScreenShare as ScreenShareIcon,\r\n    Videocam as VideoIcon,\r\n    VideocamOff as VideoOffIcon,\r\n    MoreVert as MoreVertIcon\r\n} from '@mui/icons-material';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport config from '../config';\r\n\r\nconst VoiceChannel = ({ channelId }) => {\r\n    const { token, setToken } = useAuth();\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [isDeafened, setIsDeafened] = useState(false);\r\n    const [isVideoEnabled, setIsVideoEnabled] = useState(false);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [volume, setVolume] = useState(100);\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const [connectionStatus, setConnectionStatus] = useState('disconnected'); // 'disconnected', 'connecting', 'connected'\r\n    const [error, setError] = useState('');\r\n    const [isEchoMode, setIsEchoMode] = useState(false);\r\n    \r\n    // Add new state variables for audio handling\r\n    const [audioStream, setAudioStream] = useState(null);\r\n    const [audioContext, setAudioContext] = useState(null);\r\n    const [audioProcessor, setAudioProcessor] = useState(null);\r\n    \r\n    const wsRef = useRef(null);\r\n    const mediaStreamRef = useRef(null);\r\n    const audioContextRef = useRef(null);\r\n    const mediaRecorderRef = useRef(null);\r\n    const videoStreamRef = useRef(null);\r\n    const screenStreamRef = useRef(null);\r\n    const videoContainerRef = useRef(null);\r\n    const localVideoRef = useRef(null);\r\n\r\n    // Initialize participants list\r\n    useEffect(() => {\r\n        setParticipants([]);\r\n    }, [channelId]);\r\n\r\n    useEffect(() => {\r\n        connect();\r\n        return () => {\r\n            disconnect();\r\n        };\r\n    }, [channelId, token]); // Add token as dependency\r\n\r\n    const connect = async () => {\r\n        try {\r\n            setConnectionStatus('connecting');\r\n            setError('');\r\n\r\n            // Try to refresh token before connecting\r\n            try {\r\n                const response = await fetch(`${config.API_BASE_URL}/token/refresh`, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`\r\n                    }\r\n                });\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    localStorage.setItem('token', data.access_token);\r\n                    setToken(data.access_token);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error refreshing token:', error);\r\n                setError('Authentication failed. Please log in again.');\r\n                return;\r\n            }\r\n\r\n            // Get the WebSocket protocol based on the current protocol\r\n            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n            const wsUrl = `${wsProtocol}//${config.SERVER_IP}:${config.SERVER_PORT}/ws/voice/${channelId}?token=${encodeURIComponent(token)}`;\r\n            \r\n            console.log('Connecting to WebSocket:', wsUrl);\r\n            \r\n            // Close existing connection if any\r\n            if (wsRef.current) {\r\n                wsRef.current.close();\r\n            }\r\n            \r\n            wsRef.current = new WebSocket(wsUrl);\r\n\r\n            // Set connection timeout\r\n            const connectionTimeout = setTimeout(() => {\r\n                if (wsRef.current?.readyState !== WebSocket.OPEN) {\r\n                    console.error('WebSocket connection timeout');\r\n                    setError('Connection timeout. Please try again.');\r\n                    wsRef.current?.close();\r\n                }\r\n            }, 5000);\r\n\r\n            // Set up ping interval to keep connection alive\r\n            const pingInterval = setInterval(() => {\r\n                if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                    try {\r\n                        wsRef.current.send(JSON.stringify({ type: 'ping' }));\r\n                        console.log('Sent ping message');\r\n                    } catch (error) {\r\n                        console.error('Error sending ping:', error);\r\n                    }\r\n                }\r\n            }, 15000);\r\n\r\n            // Set up connection health check\r\n            const healthCheckInterval = setInterval(() => {\r\n                if (wsRef.current?.readyState !== WebSocket.OPEN) {\r\n                    console.log('Connection health check failed, attempting to reconnect...');\r\n                    reconnect();\r\n                }\r\n            }, 30000);\r\n\r\n            wsRef.current.onopen = async () => {\r\n                console.log('WebSocket connected successfully');\r\n                clearTimeout(connectionTimeout);\r\n                setConnectionStatus('connected');\r\n                setIsConnected(true);\r\n                \r\n                // Send join message to server\r\n                try {\r\n                    if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                        wsRef.current.send(JSON.stringify({\r\n                            type: 'join'\r\n                        }));\r\n                        console.log('Sent join message');\r\n                        \r\n                        // Start audio stream after successful connection\r\n                        await startAudioStream();\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error sending join message:', error);\r\n                    setError('Failed to join voice channel. Please try again.');\r\n                    disconnect();\r\n                }\r\n            };\r\n\r\n            wsRef.current.onclose = async (event) => {\r\n                console.log('WebSocket closed:', event.code, event.reason);\r\n                clearTimeout(connectionTimeout);\r\n                clearInterval(pingInterval);\r\n                clearInterval(healthCheckInterval);\r\n                setConnectionStatus('disconnected');\r\n                setIsConnected(false);\r\n                stopAudioStream();\r\n                stopVideoStream();\r\n                stopScreenShare();\r\n                \r\n                // Handle specific error codes\r\n                switch (event.code) {\r\n                    case 4000:\r\n                        setError('Authentication failed. Please log in again.');\r\n                        break;\r\n                    case 4001:\r\n                        setError('Invalid voice channel.');\r\n                        break;\r\n                    case 4002:\r\n                        setError('You are not a member of this server.');\r\n                        break;\r\n                    case 4003:\r\n                        setError('User not found. Please log in again.');\r\n                        break;\r\n                    case 1006:\r\n                        setError('Connection lost. Attempting to reconnect...');\r\n                        reconnect();\r\n                        break;\r\n                    default:\r\n                        setError(`Connection closed: ${event.reason || 'Unknown error'}`);\r\n                        // Try to reconnect if the connection was lost\r\n                        if (event.code !== 1000) {\r\n                            reconnect();\r\n                        }\r\n                }\r\n            };\r\n\r\n            wsRef.current.onerror = (error) => {\r\n                console.error('WebSocket error:', error);\r\n                // Don't clear intervals or disconnect on error\r\n                // Let the onclose handler handle the cleanup\r\n            };\r\n\r\n            wsRef.current.onmessage = async (event) => {\r\n                if (event.data instanceof Blob) {\r\n                    try {\r\n                        console.log('Received audio data blob, size:', event.data.size);\r\n                        await playAudio(event.data);\r\n                    } catch (error) {\r\n                        console.error('Error processing audio data:', error);\r\n                    }\r\n                } else {\r\n                    try {\r\n                        const data = JSON.parse(event.data);\r\n                        console.log('Received WebSocket message:', data);\r\n                        \r\n                        if (data.type === 'token_refresh') {\r\n                            // Update token in localStorage and component\r\n                            localStorage.setItem('token', data.token);\r\n                            setToken(data.token);\r\n                            console.log('Token refreshed successfully');\r\n                            return;\r\n                        }\r\n                        \r\n                        if (data.type === 'ping') {\r\n                            try {\r\n                                wsRef.current.send(JSON.stringify({ type: 'pong' }));\r\n                                console.log('Sent pong response');\r\n                            } catch (error) {\r\n                                console.error('Error sending pong:', error);\r\n                            }\r\n                            return;\r\n                        }\r\n                        \r\n                        handleWebSocketMessage(data);\r\n                    } catch (error) {\r\n                        console.error('Error parsing WebSocket message:', error);\r\n                    }\r\n                }\r\n            };\r\n        } catch (error) {\r\n            console.error('Error connecting to voice channel:', error);\r\n            setError('Failed to connect to voice channel. Please try again later.');\r\n            setConnectionStatus('disconnected');\r\n        }\r\n    };\r\n\r\n    const handleWebSocketMessage = (data) => {\r\n        console.log('Handling WebSocket message:', data);\r\n        switch (data.type) {\r\n            case 'participants':\r\n                if (Array.isArray(data.participants)) {\r\n                    setParticipants(data.participants);\r\n                    setIsEchoMode(data.isEchoMode);\r\n                }\r\n                break;\r\n            case 'participant_joined':\r\n                if (data.participant) {\r\n                    setParticipants(prev => [...prev, data.participant]);\r\n                    setIsEchoMode(data.isEchoMode);\r\n                }\r\n                break;\r\n            case 'participant_left':\r\n                if (data.userId) {\r\n                    setParticipants(prev => prev.filter(p => p.id !== data.userId));\r\n                    setIsEchoMode(data.isEchoMode);\r\n                }\r\n                break;\r\n            case 'audio':\r\n                if (!isDeafened && data.data) {\r\n                    playAudio(data.data);\r\n                }\r\n                break;\r\n            case 'connection_status':\r\n                console.log('Connection status:', data.status);\r\n                if (data.status === 'connected') {\r\n                    setConnectionStatus('connected');\r\n                    setIsConnected(true);\r\n                }\r\n                break;\r\n            case 'pong':\r\n                console.log('Received pong response');\r\n                break;\r\n            default:\r\n                console.log('Unknown message type:', data.type);\r\n        }\r\n    };\r\n\r\n    const reconnect = () => {\r\n        console.log('Attempting to reconnect...');\r\n        setTimeout(() => {\r\n            if (wsRef.current?.readyState !== WebSocket.OPEN) {\r\n                connect();\r\n            }\r\n        }, 3000);\r\n    };\r\n\r\n    const disconnect = () => {\r\n        if (wsRef.current) {\r\n            // Send leave message before closing\r\n            if (wsRef.current.readyState === WebSocket.OPEN) {\r\n                try {\r\n                    wsRef.current.send(JSON.stringify({\r\n                        type: 'leave'\r\n                    }));\r\n                } catch (error) {\r\n                    console.error('Error sending leave message:', error);\r\n                }\r\n            }\r\n            wsRef.current.close();\r\n            wsRef.current = null;\r\n        }\r\n        stopAudioStream();\r\n        stopVideoStream();\r\n        stopScreenShare();\r\n        setIsConnected(false);\r\n    };\r\n\r\n    const startAudioStream = async () => {\r\n        try {\r\n            console.log('Starting audio stream...');\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                audio: {\r\n                    echoCancellation: true,\r\n                    noiseSuppression: true,\r\n                    autoGainControl: true,\r\n                    sampleRate: 48000,\r\n                    channelCount: 1\r\n                }\r\n            });\r\n            console.log('Got media stream:', stream.getAudioTracks()[0].label);\r\n\r\n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            const source = audioContext.createMediaStreamSource(stream);\r\n            const processor = audioContext.createScriptProcessor(1024, 1, 1);\r\n\r\n            source.connect(processor);\r\n            processor.connect(audioContext.destination);\r\n\r\n            processor.onaudioprocess = (e) => {\r\n                if (!isMuted && wsRef.current?.readyState === WebSocket.OPEN) {\r\n                    const inputData = e.inputBuffer.getChannelData(0);\r\n                    // Convert Float32Array to Int16Array for better compatibility\r\n                    const pcmData = new Int16Array(inputData.length);\r\n                    for (let i = 0; i < inputData.length; i++) {\r\n                        pcmData[i] = Math.max(-32768, Math.min(32767, Math.round(inputData[i] * 32767)));\r\n                    }\r\n                    \r\n                    // Convert to base64\r\n                    const base64Data = btoa(String.fromCharCode.apply(null, new Uint8Array(pcmData.buffer)));\r\n                    \r\n                    try {\r\n                        wsRef.current.send(JSON.stringify({\r\n                            type: 'audio',\r\n                            data: base64Data\r\n                        }));\r\n                    } catch (error) {\r\n                        console.error('Error sending audio data:', error);\r\n                    }\r\n                }\r\n            };\r\n\r\n            setAudioStream(stream);\r\n            setAudioContext(audioContext);\r\n            setAudioProcessor(processor);\r\n        } catch (error) {\r\n            console.error('Error starting audio stream:', error);\r\n            setError('Failed to access microphone. Please make sure you have granted microphone permissions.');\r\n        }\r\n    };\r\n\r\n    const stopAudioStream = () => {\r\n        if (mediaRecorderRef.current) {\r\n            mediaRecorderRef.current.stop();\r\n            mediaRecorderRef.current = null;\r\n        }\r\n        if (mediaStreamRef.current) {\r\n            mediaStreamRef.current.getTracks().forEach(track => track.stop());\r\n            mediaStreamRef.current = null;\r\n        }\r\n    };\r\n\r\n    const startVideoStream = async () => {\r\n        try {\r\n            // Request both video and audio to ensure we have the right permissions\r\n            const stream = await navigator.mediaDevices.getUserMedia({ \r\n                video: {\r\n                    width: { ideal: 1280 },\r\n                    height: { ideal: 720 },\r\n                    facingMode: 'user'\r\n                },\r\n                audio: true \r\n            });\r\n            \r\n            console.log('Video stream started:', stream.getVideoTracks()[0].label);\r\n            videoStreamRef.current = stream;\r\n            setIsVideoEnabled(true);\r\n            \r\n            // Send video stream to other participants\r\n            if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                wsRef.current.send(JSON.stringify({\r\n                    type: 'video_start',\r\n                    userId: localStorage.getItem('userId')\r\n                }));\r\n            }\r\n\r\n            // Set the stream to the video element\r\n            if (localVideoRef.current) {\r\n                localVideoRef.current.srcObject = stream;\r\n            }\r\n        } catch (error) {\r\n            console.error('Error accessing camera:', error);\r\n            setError('Failed to access camera. Please make sure you have granted camera permissions.');\r\n            setIsVideoEnabled(false);\r\n        }\r\n    };\r\n\r\n    const stopVideoStream = () => {\r\n        if (videoStreamRef.current) {\r\n            videoStreamRef.current.getTracks().forEach(track => track.stop());\r\n            videoStreamRef.current = null;\r\n            setIsVideoEnabled(false);\r\n            \r\n            if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                wsRef.current.send(JSON.stringify({\r\n                    type: 'video_stop',\r\n                    userId: localStorage.getItem('userId')\r\n                }));\r\n            }\r\n\r\n            // Clear the video stream\r\n            if (localVideoRef.current) {\r\n                localVideoRef.current.srcObject = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    const startScreenShare = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n            screenStreamRef.current = stream;\r\n            setIsScreenSharing(true);\r\n            \r\n            if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                wsRef.current.send(JSON.stringify({\r\n                    type: 'screen_share_start',\r\n                    userId: localStorage.getItem('userId')\r\n                }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error sharing screen:', error);\r\n        }\r\n    };\r\n\r\n    const stopScreenShare = () => {\r\n        if (screenStreamRef.current) {\r\n            screenStreamRef.current.getTracks().forEach(track => track.stop());\r\n            screenStreamRef.current = null;\r\n            setIsScreenSharing(false);\r\n            \r\n            if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n                wsRef.current.send(JSON.stringify({\r\n                    type: 'screen_share_stop',\r\n                    userId: localStorage.getItem('userId')\r\n                }));\r\n            }\r\n        }\r\n    };\r\n\r\n    const playAudio = async (audioData) => {\r\n        try {\r\n            console.log('Starting audio playback...');\r\n            \r\n            // Convert base64 back to Int16Array\r\n            const binaryString = atob(audioData);\r\n            const bytes = new Uint8Array(binaryString.length);\r\n            for (let i = 0; i < binaryString.length; i++) {\r\n                bytes[i] = binaryString.charCodeAt(i);\r\n            }\r\n            \r\n            // Convert to Float32Array for Web Audio API\r\n            const int16Data = new Int16Array(bytes.buffer);\r\n            const float32Data = new Float32Array(int16Data.length);\r\n            for (let i = 0; i < int16Data.length; i++) {\r\n                float32Data[i] = int16Data[i] / 32767.0;\r\n            }\r\n            \r\n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            const audioBuffer = audioContext.createBuffer(1, float32Data.length, 48000);\r\n            audioBuffer.getChannelData(0).set(float32Data);\r\n            \r\n            const source = audioContext.createBufferSource();\r\n            source.buffer = audioBuffer;\r\n            source.connect(audioContext.destination);\r\n            \r\n            source.onended = () => {\r\n                source.disconnect();\r\n                audioContext.close();\r\n            };\r\n            \r\n            source.start(0);\r\n            console.log('Audio playback started');\r\n        } catch (error) {\r\n            console.error('Error playing audio:', error);\r\n        }\r\n    };\r\n\r\n    const sendWebSocketMessage = (message) => {\r\n        if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n            try {\r\n                wsRef.current.send(typeof message === 'string' ? message : JSON.stringify(message));\r\n            } catch (error) {\r\n                console.error('Error sending WebSocket message:', error);\r\n            }\r\n        } else {\r\n            console.warn('WebSocket is not in OPEN state. Current state:', wsRef.current?.readyState);\r\n        }\r\n    };\r\n\r\n    const toggleMute = () => {\r\n        if (mediaStreamRef.current) {\r\n            const audioTrack = mediaStreamRef.current.getAudioTracks()[0];\r\n            audioTrack.enabled = !audioTrack.enabled;\r\n            setIsMuted(!isMuted);\r\n            sendWebSocketMessage({\r\n                type: 'mute_state',\r\n                isMuted: !audioTrack.enabled\r\n            });\r\n        }\r\n    };\r\n\r\n    const toggleDeafen = () => {\r\n        setIsDeafened(!isDeafened);\r\n        if (audioContextRef.current) {\r\n            const gainNode = audioContextRef.current.createGain();\r\n            gainNode.gain.value = isDeafened ? volume / 100 : 0;\r\n        }\r\n        sendWebSocketMessage({\r\n            type: 'deafen_state',\r\n            isDeafened: !isDeafened\r\n        });\r\n    };\r\n\r\n    const toggleVideo = () => {\r\n        if (isVideoEnabled) {\r\n            stopVideoStream();\r\n        } else {\r\n            startVideoStream();\r\n        }\r\n        sendWebSocketMessage({\r\n            type: 'video_state',\r\n            isEnabled: !isVideoEnabled\r\n        });\r\n    };\r\n\r\n    const toggleScreenShare = () => {\r\n        if (isScreenSharing) {\r\n            stopScreenShare();\r\n        } else {\r\n            startScreenShare();\r\n        }\r\n        sendWebSocketMessage({\r\n            type: 'screen_share_state',\r\n            isEnabled: !isScreenSharing\r\n        });\r\n    };\r\n\r\n    const handleVolumeChange = (event, newValue) => {\r\n        setVolume(newValue);\r\n        if (audioContextRef.current && !isDeafened) {\r\n            audioContextRef.current.destination.volume = newValue / 100;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Box sx={{ \r\n            display: 'flex', \r\n            flexDirection: 'column',\r\n            height: '100%',\r\n            bgcolor: 'background.paper'\r\n        }}>\r\n            {/* Connection Status */}\r\n            {error && (\r\n                <Alert severity=\"error\" sx={{ mb: 2 }}>\r\n                    {error}\r\n                </Alert>\r\n            )}\r\n            \r\n            {connectionStatus === 'connecting' && (\r\n                <Alert severity=\"info\" sx={{ mb: 2 }}>\r\n                    Connecting to voice channel...\r\n                </Alert>\r\n            )}\r\n\r\n            {isEchoMode && (\r\n                <Alert severity=\"info\" sx={{ mb: 2 }}>\r\n                    Echo Mode Active - You are the only participant in this voice channel\r\n                </Alert>\r\n            )}\r\n\r\n            {/* Video Container */}\r\n            <Box \r\n                ref={videoContainerRef}\r\n                sx={{ \r\n                    p: 2, \r\n                    display: 'flex', \r\n                    justifyContent: 'center',\r\n                    bgcolor: 'background.default'\r\n                }}\r\n            >\r\n                {isVideoEnabled ? (\r\n                    <video\r\n                        ref={localVideoRef}\r\n                        autoPlay\r\n                        muted\r\n                        playsInline\r\n                        style={{\r\n                            width: '100%',\r\n                            maxHeight: '200px',\r\n                            objectFit: 'cover',\r\n                            borderRadius: '8px'\r\n                        }}\r\n                    />\r\n                ) : (\r\n                    <Typography variant=\"body2\" color=\"text.secondary\">\r\n                        Camera is disabled\r\n                    </Typography>\r\n                )}\r\n            </Box>\r\n\r\n            {/* Participants List */}\r\n            <List sx={{ flex: 1, overflow: 'auto' }}>\r\n                {Array.isArray(participants) && participants.map((participant) => (\r\n                    <ListItem key={participant.id}>\r\n                        <ListItemAvatar>\r\n                            <Badge\r\n                                overlap=\"circular\"\r\n                                anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\r\n                                badgeContent={\r\n                                    <Box sx={{ \r\n                                        width: 12, \r\n                                        height: 12, \r\n                                        borderRadius: '50%',\r\n                                        bgcolor: participant.isMuted ? 'error.main' : 'success.main',\r\n                                        border: '2px solid',\r\n                                        borderColor: 'background.paper'\r\n                                    }} />\r\n                                }\r\n                            >\r\n                                <Avatar>{participant.username?.[0] || '?'}</Avatar>\r\n                            </Badge>\r\n                        </ListItemAvatar>\r\n                        <ListItemText \r\n                            primary={participant.username || 'Unknown User'}\r\n                            secondary={\r\n                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                    {participant.isMuted && <MicOffIcon fontSize=\"small\" />}\r\n                                    {participant.isDeafened && <HeadsetOffIcon fontSize=\"small\" />}\r\n                                    {participant.isVideoEnabled && <VideoIcon fontSize=\"small\" />}\r\n                                    {participant.isScreenSharing && <ScreenShareIcon fontSize=\"small\" />}\r\n                                </Box>\r\n                            }\r\n                        />\r\n                    </ListItem>\r\n                ))}\r\n            </List>\r\n\r\n            {/* Controls */}\r\n            <Box sx={{ \r\n                p: 2, \r\n                borderTop: 1, \r\n                borderColor: 'divider',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center'\r\n            }}>\r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Tooltip title={isMuted ? \"Unmute\" : \"Mute\"}>\r\n                        <IconButton onClick={toggleMute} color={isMuted ? \"error\" : \"default\"}>\r\n                            {isMuted ? <MicOffIcon /> : <MicIcon />}\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title={isDeafened ? \"Undeafen\" : \"Deafen\"}>\r\n                        <IconButton onClick={toggleDeafen} color={isDeafened ? \"error\" : \"default\"}>\r\n                            {isDeafened ? <HeadsetOffIcon /> : <HeadsetIcon />}\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </Box>\r\n\r\n                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                    <Tooltip title={isVideoEnabled ? \"Disable Video\" : \"Enable Video\"}>\r\n                        <IconButton onClick={toggleVideo} color={isVideoEnabled ? \"primary\" : \"default\"}>\r\n                            {isVideoEnabled ? <VideoIcon /> : <VideoOffIcon />}\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title={isScreenSharing ? \"Stop Sharing\" : \"Share Screen\"}>\r\n                        <IconButton onClick={toggleScreenShare} color={isScreenSharing ? \"primary\" : \"default\"}>\r\n                            <ScreenShareIcon />\r\n                        </IconButton>\r\n                    </Tooltip>\r\n                </Box>\r\n\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, minWidth: 200 }}>\r\n                    <VolumeUpIcon />\r\n                    <Slider\r\n                        value={volume}\r\n                        onChange={handleVolumeChange}\r\n                        aria-labelledby=\"volume-slider\"\r\n                        min={0}\r\n                        max={100}\r\n                    />\r\n                </Box>\r\n            </Box>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default VoiceChannel; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}